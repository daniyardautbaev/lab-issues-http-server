**Кратко:** учебный репозиторий с маленьким HTTP-сервером на Flask, который специально содержит уязвимости для лабораторной работы: утечка внутренней информации через ошибки, хардкод-секреты и конфигурация с секретами в репозитории, небезопасная десериализация. Цель — продемонстрировать уязвимости, проанализировать риски и сделать PR с исправлениями.

---

## Содержание репозитория
- \`vulnerable_app.py\` — уязвимая версия сервера (демонстрация ошибок).
- \`config.json\` — конфигурация с секретами (намеренно закоммичена).
- \`requirements.txt\` — зависимости Python.
- \`README.md\` — этот файл.
- (после фикса) \`.env.example\`, \`.gitignore\`, \`fixed_app.py\` и ветка \`fix/...\` с PR.

---

## Как запустить локально
1. Клонируй репо (или обнови локальный клон):
\`\`\`bash
git clone https://github.com/<your-username>/lab-issues-http-server.git
cd lab-issues-http-server
\`\`\`

2. Создай и активируй виртуальное окружение:
\`\`\`bash
python3 -m venv venv
source venv/bin/activate   # macOS / Linux (zsh / bash)
# venv\Scripts\activate    # Windows (PowerShell)
\`\`\`

3. Установи зависимости:
\`\`\`bash
pip install -r requirements.txt
\`\`\`

4. Запусти сервер (dev mode):
\`\`\`bash
python vulnerable_app.py
\`\`\`
Открой в браузере: \`http://127.0.0.1:5001\` (порт может отличаться).

---

## Уязвимые эндпоинты (демонстрация)
- \`/cause-error\` — вызывает ошибку и в dev возвращает stack trace (traceback).
- \`/show-secret\` — возвращает хардкод-ключ (демонстрация хардкода).
- \`/unsafe-deserialize\` — демонстрация небезопасной десериализации (использует \`eval\` в уязвимой версии).

### Примеры curl
\`\`\`bash
curl -i http://127.0.0.1:5001/show-secret
curl -i http://127.0.0.1:5001/cause-error
curl -i -X POST http://127.0.0.1:5001/unsafe-deserialize \
  -H "Content-Type: application/json" \
  -d '{"payload": "1+1"}'
\`\`\`

---

## Что нужно сделать в лабораторной
1. **Демонстрация уязвимостей** — сделать скриншоты:
   - \`/cause-error\` (стек-трейс)
   - \`vulnerable_app.py\` (виден \`SECRET_API_KEY\` и \`eval\`)
   - \`config.json\` в репозитории (пароль)

2. **Анализ рисков** — коротко описать для каждой уязвимости:
   - Traceback: раскрытие структуры и версий, помогает атакующим.
   - Закоммиченные секреты: компрометация БД/сервисов.
   - Unsafe deserialization: RCE (исполнение произвольного кода).

3. **Исправления (в ветке \`fix/secrets-errors-deserialize\`)**:
   - Вынести секреты в \`.env\` и добавить \`.env.example\`.
   - Добавить \`.gitignore\` (включить \`.env\`, \`venv/\`, \`config.json\`).
   - Удалить \`config.json\` из индекса: \`git rm --cached config.json\`.
   - Отключить \`debug=True\`, добавить глобальный error handler (логирование в файл).
   - Убрать \`eval\` и использовать безопасную десериализацию + валидацию.

4. **PR**:
   - Заголовок: \`Fix: remove hardcoded secrets, secure error handling and deserialization\`
   - Описание: перечислить изменения, как проверить, почему это безопасно.

---

## Рекомендации по безопасности (после фиксов)
- Использовать \`.env\` + \`.env.example\` вместо коммитов секретов.
- Включить в CI сканер секретов (git-secrets, truffleHog).
- Политика ревью кода и ограничение debug в prod.
- При необходимости удалить секреты из истории с помощью \`bfg\` или \`git filter-branch\`.

---
